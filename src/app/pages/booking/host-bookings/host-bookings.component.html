<section class="host-bookings">
  <div class="header">
    <h1>Reservas de mis alojamientos</h1>
    <p>Administra las reservas asociadas a tus alojamientos</p>
    <button class="btn-secondary" (click)="testBackendConnection()" style="margin-top: 10px;">
      ðŸ§ª Probar ConexiÃ³n Backend
    </button>
  </div>

  <div class="tabs">
    <button class="tab" [class.active]="tab==='todas'" (click)="tab='todas'">
      Todas
    </button>
    <button class="tab" [class.active]="tab==='pendientes'" (click)="tab='pendientes'">
      Pendientes
    </button>
    <button class="tab" [class.active]="tab==='activas'" (click)="tab='activas'">
      Activas
    </button>
    <button class="tab" [class.active]="tab==='canceladas'" (click)="tab='canceladas'">
      Canceladas
    </button>
  </div>

  <div class="content">
    <div class="error-banner" *ngIf="errorMsg()">
      <span class="msg">{{ errorMsg() }}</span>
      <button class="btn-primary" (click)="retry()">Reintentar</button>
    </div>
    <div class="empty" *ngIf="items.length === 0">
      <img src="/icons/calendar.svg" alt="Reservas" width="64" height="64" />
      <h3>No hay reservas para mostrar</h3>
      <p>Cuando recibas solicitudes o confirmaciones, aparecerÃ¡n aquÃ­.</p>
      <a routerLink="/mis-alojamientos" class="btn-primary">Ir a mis alojamientos</a>
    </div>

    <div class="list" *ngIf="items.length > 0">
      <div class="booking" *ngFor="let b of items">
        <div class="left">
          <div class="thumb">
            <img 
              [src]="thumb(b.listing?.imagenes?.[0])" 
              [attr.srcset]="thumbSrcSet(b.listing?.imagenes?.[0])" 
              [attr.sizes]="thumbSize()" 
              loading="lazy" 
              decoding="async" 
              alt="Alojamiento" 
            />
          </div>
          <div class="info">
            <h3>{{ b.listing?.titulo || 'Alojamiento' }}</h3>
            <p class="dates">{{ b.fechaInicio }} â†’ {{ b.fechaFin }}</p>
            <p class="meta">HuÃ©spedes: {{ b.huespedes }} Â· Estado: {{ b.estado }}</p>
          </div>
        </div>
        <div class="right">
          <a [routerLink]="['/alojamientos', b.listingId]" class="btn">Ver alojamiento</a>
          <a [routerLink]="['/reserva', b.id]" class="btn">Ver detalle</a>
          <a [routerLink]="['/reserva', b.id, 'mensajes']" class="btn">Mensajes</a>
          <button class="btn success" *ngIf="b.estado === 'pendiente'" (click)="aceptar(b.id)" [disabled]="actionLoading[b.id]" [attr.aria-busy]="actionLoading[b.id]">
            {{ actionLoading[b.id] ? 'Procesando...' : 'Aceptar' }}
          </button>
          <button class="btn danger" *ngIf="b.estado === 'pendiente'" (click)="rechazar(b.id)" [disabled]="actionLoading[b.id]">
            {{ actionLoading[b.id] ? 'Procesando...' : 'Rechazar' }}
          </button>
        </div>
      </div>
    </div>
    <div class="list" *ngIf="items.length === 0 && loading">
      <div class="booking" *ngFor="let i of [1,2,3,4]">
        <div class="left">
          <div class="thumb"><div class="skeleton-thumb"></div></div>
          <div class="info">
            <div class="skeleton-line"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
        <div class="right">
          <div class="skeleton-btn"></div>
          <div class="skeleton-btn"></div>
        </div>
      </div>
    </div>
  </div>
</section>
