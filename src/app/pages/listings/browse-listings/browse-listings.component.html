<section class="dashboard">
  <div class="search-section">
    <div class="search-bar">
      <img src="/icons/map.svg" alt="Mapa" class="map-icon">
      <input 
        [value]="ciudad()" 
        (input)="updateCiudad($event.target.value)"
        placeholder="Ciudad" 
        class="search-input"
        (keydown)="onEnterKey($event)"
        [disabled]="loading()"
      >
      <span class="divider">|</span>
      <input 
        type="date" 
        [value]="fechaInicio() || ''" 
        (input)="updateFechaInicio($event.target.value || undefined)"
        placeholder="Fecha inicio" 
        class="search-input"
        [disabled]="loading()"
      >
      <span class="divider">|</span>
      <input 
        type="number" 
        [value]="numPersonas() || ''" 
        (input)="updateNumPersonas($event.target.value ? +$event.target.value : undefined)"
        placeholder="N√∫mero personas" 
        class="search-input"
        min="1"
        max="20"
        (keydown)="onEnterKey($event)"
        [disabled]="loading()"
      >
      <span class="divider">|</span>
      <div class="services-input-container" #servicesContainer>
        <input 
          [value]="servicios()" 
          (input)="updateServicios($event.target.value)"
          placeholder="Servicios (ej: WiFi, Piscina)" 
          class="search-input services-input"
          (keydown)="onEnterKey($event)"
          (focus)="openServices()"
          (click)="openServices()"
          (blur)="closeServices()"
          [disabled]="loading()"
          #servicesInput
        >
        <div class="services-dropdown" [class.open]="servicesOpen()" *ngIf="!loading()">
          <div class="dropdown-header">
            <button type="button" class="close-dropdown" (click)="closeServices()" title="Cerrar">‚úï Cerrar</button>
          </div>
          <div class="services-grid">
            <button 
              type="button" 
              class="service-tag" 
              *ngFor="let servicio of serviciosComunes"
              (click)="onServicioSelect(servicio)"
            >
              {{ servicio }}
            </button>
          </div>
        </div>
      </div>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="buscar()"
        [disabled]="loading()"
        [attr.aria-busy]="loading()"
      >
        <span *ngIf="!loading()">üîç Buscar</span>
        <span *ngIf="loading()">‚è≥ Buscando...</span>
      </button>
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="limpiarFiltros()"
        [disabled]="loading() || !hasFilters()"
        *ngIf="hasFilters() || hasSearched()"
      >
        ‚úï Limpiar
      </button>
      <button 
        type="button" 
        class="btn btn-outline" 
        (click)="refreshData()"
        [disabled]="loading()"
        [attr.aria-busy]="loading()"
        title="Actualizar datos"
      >
        üîÑ Actualizar
      </button>
    </div>
    
    <!-- Indicador de filtros activos -->
    <div class="active-filters" *ngIf="hasFilters()">
      <span class="filter-label">Filtros activos:</span>
      <span class="filter-tag" *ngIf="ciudad()">
        üìç {{ ciudad() }}
      </span>
      <span class="filter-tag" *ngIf="numPersonas()">
        üë• {{ numPersonas() }} persona(s)
      </span>
      <span class="filter-tag" *ngIf="servicios()">
        üè∑Ô∏è {{ servicios() }}
      </span>
    </div>
    
    <!-- Estad√≠sticas de b√∫squeda -->
    <div class="search-stats" *ngIf="searchStats().total > 0">
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-value">{{ searchStats().total }}</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat-item" *ngIf="hasFilters()">
          <span class="stat-value">{{ searchStats().filtered }}</span>
          <span class="stat-label">Filtrados</span>
        </div>
        <div class="stat-item" *ngIf="searchStats().cities > 0">
          <span class="stat-value">{{ searchStats().cities }}</span>
          <span class="stat-label">Ciudades</span>
        </div>
        <div class="stat-item" *ngIf="searchStats().averagePrice > 0">
          <span class="stat-value">{{ searchStats().averagePrice | currencyUser }}</span>
          <span class="stat-label">Precio promedio</span>
        </div>
      </div>
    </div>
  </div>

  <div class="tabs-section">
    <div class="tabs">
      <button type="button" class="tab" [class.active]="view==='alojamientos'" (click)="view='alojamientos'">
        <img src="/icons/lodging.svg" class="icon-img" alt="Alojamientos">
        <span>Alojamientos</span>
      </button>
      <button type="button" class="tab" [class.active]="view==='servicios'" (click)="view='servicios'">
        <img src="/icons/services.svg" class="icon-img" alt="Servicios">
        <span>Servicios</span>
      </button>
    </div>
  </div>

  <div class="content-section">
    <div class="error-banner" *ngIf="errorMsg() && !loading()">
      <span class="msg">{{ errorMsg() }}</span>
      <button type="button" class="btn btn-secondary" (click)="retry()">Reintentar</button>
    </div>
    <!-- Loading state -->
    <div class="loading-state" *ngIf="loading()">
      <div class="loading-spinner"></div>
      <p>Cargando alojamientos...</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" style="margin-top:16px;">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5,6,7,8]">
          <div class="skeleton-image"></div>
          <div class="skeleton-lines">
            <div class="line"></div>
            <div class="line short"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results for alojamientos -->
    <div *ngIf="view==='alojamientos' && !loading()">
      <!-- Results count -->
      <div class="results-info" *ngIf="filtradas().length > 0">
        <p>
          <strong>{{ filtradas().length }}</strong> 
          {{ filtradas().length === 1 ? 'alojamiento encontrado' : 'alojamientos encontrados' }}
          <span *ngIf="hasSearched() && hasFilters()"> con los filtros aplicados</span>
        </p>
      </div>

      <!-- Results grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" *ngIf="filtradas().length > 0">
        <app-accommodation-card *ngFor="let l of filtradas()" [listing]="l" />
      </div>

      <!-- Empty state -->
      <div class="empty-state" *ngIf="filtradas().length === 0">
        <div class="empty-content">
          <img src="/icons/search.svg" alt="Sin resultados" class="empty-icon">
          <h3 *ngIf="hasSearched()">No se encontraron alojamientos</h3>
          <h3 *ngIf="!hasSearched()">No hay alojamientos disponibles</h3>
          <p *ngIf="hasSearched() && hasFilters()">
            Intenta modificar tus criterios de b√∫squeda o 
            <button type="button" class="link-button" (click)="limpiarFiltros()">eliminar los filtros</button>.
          </p>
          <p *ngIf="!hasSearched()">
            Actualmente no hay alojamientos disponibles para mostrar.
            <button type="button" class="link-button" (click)="refreshData()">Cargar datos</button>
          </p>
        </div>
      </div>
    </div>

    <!-- Services tab (unchanged) -->
    <div class="empty" *ngIf="view==='servicios'">
      <div class="empty-content">
        <img src="/icons/services.svg" alt="Servicios" class="empty-icon">
        <h3>Pr√≥ximamente</h3>
        <p>Estamos trabajando en el cat√°logo de servicios adicionales.</p>
      </div>
    </div>
  </div>
</section>
