<article class="card" [class.host-view]="hostView">
  <div class="image-container">
    <a [routerLink]="['/alojamientos', listing.id]">
      <img 
        [src]="mainImage" 
        [attr.srcset]="mainSrcSet" 
        [attr.sizes]="mainSizes"
        loading="lazy" 
        decoding="async" 
        [alt]="listing.titulo || 'Alojamiento'" 
        (error)="onImageError($event)" 
      />
    </a>
    
    <!-- Botón de favoritos para vista de huésped -->
    @if (!hostView) {
      <button 
        class="favorite-btn" 
        [class.is-favorite]="isFavorite"
        (click)="toggleFavorite($event)"
        [disabled]="loading()"
        [attr.aria-busy]="loading()"
        [title]="isFavorite ? 'Quitar de favoritos' : 'Agregar a favoritos'"
        type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </button>
    }
    
    <!-- Acciones para vista de anfitrión -->
    @if (hostView) {
      <div class="host-actions">
        <button class="action-btn edit" title="Editar" [routerLink]="['/editar-alojamiento', listing.id]" type="button">
          <img src="/icons/edit.svg" alt="Editar" width="16" height="16">
        </button>
        <button class="action-btn stats" title="Estadísticas" [routerLink]="['/metricas', listing.id]" type="button">
          <img src="/icons/stats.svg" alt="Estadísticas" width="16" height="16">
        </button>
        <button class="action-btn delete" title="Eliminar alojamiento" (click)="deleteListing($event)" type="button" [disabled]="loading()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"/>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
        </button>
      </div>
    }
  </div>
  
  <div class="info">
    <div class="header">
      <h3>{{ listing.titulo }}</h3>
      @if (hostView) {
        <div class="status-badge active">Activo</div>
      }
    </div>
    
    <div class="rating-location">
      <div class="stars">
        <img src="/icons/star.svg" alt="Estrella" width="14" height="14">
        <span class="rating">{{ (listing.calificacionPromedio || 0).toFixed(1) }}</span>
      </div>
      <div class="location">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        <span>
          {{ listing.ubicacion.direccion ? (listing.ubicacion.direccion + ', ') : '' }}{{ listing.ubicacion.ciudad }}, {{ listing.ubicacion.pais }}
        </span>
      </div>
    </div>
    
    <p class="descripcion">{{ listing.descripcion }}</p>
    
    <div class="amenities">
      <span class="amenity" *ngFor="let amenity of listing.servicios.slice(0, 3)">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12l2 2 4-4"/>
        </svg>
        {{ amenity }}
      </span>
      @if (listing.servicios.length > 3) {
        <span class="more-amenities">+{{ listing.servicios.length - 3 }} más</span>
      }
    </div>
    
    <div class="footer">
      <div class="price">
        <span class="amount">{{ listing.precioPorNoche | currencyUser: listing.currencyCode }}</span>
        <span class="period">/ noche</span>
      </div>
      
      
    </div>
  </div>
</article>
